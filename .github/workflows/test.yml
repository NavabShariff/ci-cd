name: test

on:
 push:
  branches: ['main']


jobs:
  license-checking:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v4
      with:
       path: .

    - name: 'Install license-finder'
      run: |
        echo "Installing license_finder"
        sudo apt install ruby ruby-dev
        sudo gem install license_finder

    - name: check license scan
      run: |
        license_finder --project-path=. --decisions-file=doc/dependency_decisions.yml
        
        exit_code=$?

        if [[ $exit_code -ne 0 ]]; then
         echo "There are dependency's that need to approval"
         exit 1
        else
         echo "All dependencies are approved"
        fi

    - name: check
      run: |
        ls -lh
        ls -lh target/